<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="../../public/assets/plugins/respond.min.js"></script>
<script src="../../public/assets/plugins/excanvas.min.js"></script> 
<![endif]-->
<script src="${pageContext.request.contextPath}/public/javascripts/jquery-2.1.3.js" type="text/javascript"></script>

<!-- IMPORTANT! Load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="${pageContext.request.contextPath}/public/assets/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>

<script src="${pageContext.request.contextPath}/public/assets/plugins/jquery.cokie.min.js" type="text/javascript"></script>

<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->

<script src="${pageContext.request.contextPath}/public/assets/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>

<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-daterangepicker/moment.min.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-daterangepicker/daterangepicker.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/gritter/js/jquery.gritter.js" type="text/javascript"></script>

<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="${pageContext.request.contextPath}/public/assets/plugins/jquery-validation/dist/jquery.validate.min.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/backstretch/jquery.backstretch.min.js" type="text/javascript"></script>
<%-- <script type="text/javascript" src="${pageContext.request.contextPath}/public/assets/plugins/select2/select2.min.js"></script> --%>
<script src="${pageContext.request.contextPath}/public/assets/scripts/core/app.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/scripts/custom/index.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/scripts/custom/tasks.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/scripts/custom/login-soft.js" type="text/javascript"></script>

<!-- CHART JS  -->

<script src="${pageContext.request.contextPath}/public/javascripts/canvasjs.min.js" type="text/javascript"></script>

<script src="${pageContext.request.contextPath}/public/javascripts/highstock.js"></script>
<%-- <script src="${pageContext.request.contextPath}/public/javascripts/highcharts.js" type="text/javascript"></script> --%>
<script src="${pageContext.request.contextPath}/public/javascripts/highcharts-more.js" type="text/javascript"></script>
<!-- <script type="text/javascript" src="https://rawgithub.com/cowboy/jquery-resize/v1.1/jquery.ba-resize.js"></script> -->
<script src="${pageContext.request.contextPath}/public/javascripts/exporting.js" type="text/javascript"></script>

<!-- END CHART JS  -->
<!-- datatables -->
<script src="${pageContext.request.contextPath}/public/assets/plugins/data-tables/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/data-tables/DT_bootstrap.js" type="text/javascript"></script>
<!-- end of datatables -->

<!-- bootstrap switch -->
<script src="${pageContext.request.contextPath}/public/javascripts/bootstrap-toggle.min.js"></script>

<script src="${pageContext.request.contextPath}/public/javascripts/MicroGrid.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-fileinput/bootstrap-fileinput.js"></script>
<script src="${pageContext.request.contextPath}/public/javascripts/jquery.form.js"></script>

<!-- end of bootstrap switch -->
<!-- END PAGE LEVEL SCRIPTS -->
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-fileinput/bootstrap-fileinput.js"></script>
<script src="${pageContext.request.contextPath}/public/javascripts/jquery.form.js"></script>
<script src="${pageContext.request.contextPath}/public/javascripts/country.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-toastr/toastr.min.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/scripts/custom/ui-toastr.js"></script>


<script src="${pageContext.request.contextPath}/public/javascripts/pdf/FileSaver.js"></script>
<script src="${pageContext.request.contextPath}/public/javascripts/pdf/jspdf.min.js"></script>
<script src="${pageContext.request.contextPath}/public/javascripts/pdf/jspdf.plugin.table.js"></script>
<script src="${pageContext.request.contextPath}/public/javascripts/Date.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/jquery-easy-pie-chart/jquery.easy-pie-chart.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script src="${pageContext.request.contextPath}/public/assets/scripts/custom/components-pickers.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/jquery-knob/js/jquery.knob.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/scripts/custom/components-knob-dials.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-wysihtml5/wysihtml5-0.3.0.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/scripts/custom/components-editors.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/plugins/ionrangeslider/js/ion-rangeSlider/ion.rangeSlider.min.js"></script>
<script src="${pageContext.request.contextPath}/public/assets/scripts/custom/components-ion-sliders.js"></script>
<script src="${pageContext.request.contextPath}/public/javascripts/timezones.full.min.js"></script>
<script src="${pageContext.request.contextPath}/public/javascripts/markerclusterer.js"></script>

<!--Java script to use multiple selectbox  -->
<script src="${pageContext.request.contextPath}/public/assets/plugins/select2/select2.min.js" type="text/javascript"></script>

<!--Java script to use bootbox  -->
<script src="${pageContext.request.contextPath}/public/assets/plugins/bootbox/bootbox.min.js"></script>

<!--Javascript to use go js  -->
<script src="${pageContext.request.contextPath}/public/javascripts/go-debug.js"></script>

<!--Javascript to use with joint js  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jointjs/1.1.0/joint.js"></script>

<div id="site_url" style="display:none">${pageContext.request.contextPath}</div>

<script>
$(document).ready(function(){
	setActiveMenu();
	allowed_other_attribute();
	var site_url = $('#site_url').html();
	var username = $.cookie("username");
	var current_url = window.location.href;
	var token = $.cookie("token");
	console.log("username = "+username+ "  token = "+token);
	if(username && token){
		
		$("#user_name").html(username);
		//console.log(current_url.indexOf(site_url+"/rest/home/login"));
		if(current_url.indexOf(site_url+"/rest/home/login") > 0){
			//window.location.href = site_url+"/rest/micro/locationMap.html";
			var sepOnly = $.cookie("sepOnly");
			if(sepOnly == 'true'){
				window.location.href = site_url+"/rest/sep/home/index";
			} else {
				window.location.href = site_url+"/rest/micro/locationMap";
			}
		}
		var image = $.cookie("image");
		//console.log("image = "+image);
		if(image!="" && image!=undefined && image!="null"){
			//console.log("====");
			$("#login_user_pic").prop("src",site_url+image);
		}else{
			$("#login_user_pic").prop("src",site_url+"/public/images/user.png");
		}
		var roleName = $.cookie("roleName");
		//console.log("roleName = "+roleName);
		if(roleName=="customer-admin"){			
			$("#roleManagement").hide();
			$(".li_custom_menu").addClass("hideMenu");
			
		}else if(roleName=="operator"){			
			$("#roleManagement").hide();
			$("#userManagement").hide();
			$(".li_custom_menu").addClass("hideMenu");
			$(".hiper").addClass("hideMenu");
		}
		
	}else{
		//console.log(current_url);
		//console.log(current_url.indexOf(site_url+"/rest/home/login"));
		if(current_url.indexOf(site_url+"/rest/home/login") < 0){
			//window.location.href = site_url+"/rest/home/login.jsp";		
		}
	}
	$('#logout_btn').click(function(){
		$.ajax({
			url : site_url+"/rest/login/logout",
			type : "POST",
			contentType : "application/json",
			dataType : "json",
			success : function(data) {
			  if(data.status == true){
				  $.removeCookie('username', { path: '/' });
					$.removeCookie('token', { path: '/' });
				  	$.removeCookie('user', { path: '/' });
					$.removeCookie('roleName', { path: '/' });
				  	$.removeCookie('image', { path: '/' });
					$.removeCookie('token', { path: '/' });
				  	$.removeCookie('logintoken', { path: '/' });
				  	$.removeCookie("fullname", { path: '/' });
				  	$.removeCookie("sepOnly",{path: '/'});
				   window.location.href = site_url+"/rest/home/login";	
			  }else{
				  	
			  }
			}
		});	
		
	});
	setTimeout(function(){
		$.ajax({
			url : site_url+"/rest/login/checkLogin",
			type : "POST",
			contentType : "application/json",
			dataType : "json",
				success : function(data) {
			  if(data.status == true){
				  	
			  }else{
				  			
				  $.removeCookie('username', { path: '/' });
					$.removeCookie('token', { path: '/' });
				  	$.removeCookie('user', { path: '/' });
					$.removeCookie('roleName', { path: '/' });
				  	$.removeCookie('image', { path: '/' });
					$.removeCookie('token', { path: '/' });
				  	$.removeCookie('logintoken', { path: '/' });	
				  	$.removeCookie("fullname", { path: '/' });
				  	
				  	var lurl = window.location.href;
				  	var arr = lurl.split("/");
				  	var jsp = arr[arr.length -1];
				  	var name = jsp.split(".")[0];
				  	
				  	if(name != 'login'){
				  		toastr.info("Either you have disabled cookies or you have not logged in properly. \n Page will be redirected to login");
					  	setTimeout(function(){
					  		window.location.href = site_url+"/rest/home/login.jsp";
					  	},3000);
				  		
				  	}
				  	
				   
			  }
			}
		});
	}, 2000);
	
	$("#dashboard").click(function(){
		var microgrid_id = $.cookie("microgrid_id");
		if(microgrid_id!="" && microgrid_id!=undefined){
	        window.location.href = "${pageContext.request.contextPath}/rest/home/currentstatus/"+microgrid_id;
		}else{
			toastr.info("First select microgrid controller");
			window.setTimeout(function(){
		        window.location.href = "${pageContext.request.contextPath}/rest/micro/list";
		    }, 4000);	
		}
	});
	$(".active_menu").click(function(){
		$(".active_menu").each(function(){
			if($(this).hasClass("active")){
				$(this).removeClass("active");
				$(this).removeClass("open");
				$(this).find(".arrow").removeClass("open");
			}	
		});
		$(this).addClass("active");
		$(this).addClass("open");
		$(this).find(".arrow").addClass("open");		
	});
	
	toastr.options = {
			  "closeButton": true,
			  "debug": false,
			  "positionClass": "toast-top-center",
			  "showDuration": "1000",
			  "hideDuration": "1000",
			  "timeOut": "5000",
			  "extendedTimeOut": "1000",
			  "showEasing": "swing",
			  "hideEasing": "linear",
			  "showMethod": "fadeIn",
			  "hideMethod": "fadeOut"
			}
	$("#backpage").click(function(){	
		window.history.go(-1);
	});
	
	var roleName = $.cookie("roleName");
	handleSEPMenuPermission();
	/* if(roleName != 'super-admin'){
		
	} else {
		$('.seponly').css('display','block');
		$('.sep').css('display','block');
	} */
	
	

});



$(".open_dashboard").click(function(){
	alert();
	var microgrid_id = $.cookie("microgrid_id");
	if(microgrid_id!="" && microgrid_id!=undefined){
        window.location.href = "${pageContext.request.contextPath}/rest/home/currentstatus/"+microgrid_id;
	}else{
		toastr.info("First select microgrid controller");
		window.setTimeout(function(){
	        window.location.href = "${pageContext.request.contextPath}/rest/micro/list";
	    }, 4000);	
	}
});

 function setActiveMenu(){
	var url = window.location.href;
	url = url.split("/");
	var tag = url[5];	
	$(".active_menu").each(function(){
		if($(this).hasClass("active")){
			$(this).removeClass("active");
			$(this).removeClass("open");
			$(this).find('.arrow').removeClass("open");
		}	
	});
	if(tag == 'sep'){
		tag = url[6];
	}
	$("."+tag).addClass("active");
	$("."+tag).addClass("open");	
	$("."+tag).find('.arrow').addClass("open");
} 

function allowed_other_attribute(){
	var roleName = $.cookie("roleName");
	//console.log("roleName = "+roleName);
	if(roleName=="customer-admin"){
		$(".allowed_super_admin").hide();	
	}	
}

function adoptTimeZone(arg){	
	var mdate = new Date(moment.tz(eval(arguments[0]),arguments[1]).format('YYYY-MM-DD HH:mm:ss'));
	return mdate.getTime();
}

function getMicroGridIdFromUrl(){
	var arr = window.location.href.split('/');
	return arr[arr.length-1];
}

function handleSEPMenuPermission(){
	if(window.location.href.indexOf('login') != -1){
		return;
	}
	var object = new Object();	
	object.token = $.cookie("token");
	var data = JSON.stringify(object);
	console.log(data);
	$.ajax({
		url:'${pageContext.request.contextPath}/rest/users/checkUserAdminPerForSEP',
		type:'POST',
		contentType: 'application/json',
		data: data,
		success: function(response){
			console.log(response);
			if(response.status == 'success'){
				
				if(response.access == true){
					$('.sep').css('display','block');
				}
				if(response.seponly == true){
					$('.seponly').css('display','none');
					$('.sep').css('display','block');
					$('.analysis').css('display','none');
				} /* else {
					$('.seponly').css('display','block');
				} */
				
				if(response.analysisAccess == true){
					$('.analysis').css('display','block');
				} else if(response.analysisOnlyAccess == true){
					$('.analysis').css('display','block');
					$('.seponly').css('display','none');
					$('.sep').css('display','none');
				}
				
				if(response.seponly == true || response.analysisOnlyAccess == true){
					$('.seponly').css('display','none');
				} else {
					$('.seponly').css('display','block');
				}
			} else {
				$('.sep').hide();
			}
			var role = $.cookie("roleName");
			if(role == 'customer-admin' || role == 'operator'){
				$('.derprograms').hide();
			}
		}
		
	});
}

$("#en_scope_logo_pic").on('click', function(){
	console.log($.cookie("sepOnly"));
	var sepOnly = $.cookie("sepOnly");
	if(sepOnly == 'true'){
		window.location.href = '${pageContext.request.contextPath}/rest/sep/home/index';
	} else {
		window.location.href = '${pageContext.request.contextPath}/rest/micro/locationMap';
	}
});

</script>
